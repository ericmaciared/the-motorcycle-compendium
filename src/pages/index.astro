---
import BaseLayout from '../layouts/BaseLayout.astro';
import BikeCard from '../components/BikeCard.astro';
import { supabase } from '../lib/supabase';

const { data: bikes, error } = await supabase
  .from('motorbike_variants')
  .select(`
    *,
    motorbike_models!inner (
      name,
      category,
      manufacturers!inner (
        name
      )
    )
  `)
  .order('created_at', { ascending: false })
  .limit(8);

if (error) {
  console.error('Error fetching bikes:', error);
}

const motorcycles = bikes?.map(bike => ({
  id: bike.id,
  slug: bike.slug,
  variant_name: bike.variant_name,
  year: bike.year,
  price_usd: bike.price_usd,
  engine_displacement_cc: bike.engine_displacement_cc,
  horsepower_hp: bike.horsepower_hp,
  description: bike.description,
  model_name: bike.motorbike_models.name,
  manufacturer_name: bike.motorbike_models.manufacturers.name,
  category: bike.motorbike_models.category,
})) || [];

const { data: manufacturers, error: manufacturersError } = await supabase.from('manufacturers').select('*');

if (manufacturersError) {
  console.error('Error fetching manufacturers:', manufacturersError);
}

const manufacturerCount = manufacturers?.length || 0;
const bikeCount = bikes?.length || 0;
---

<BaseLayout title="The Motorbike Compendium - Your Complete Motorcycle Reference">
  <!-- Hero Section - Topographic/Meteorological Style -->
  <section class="relative bg-topo-50 text-topo-900 py-24 md:py-32 overflow-hidden">
    <!-- Topographic map pattern background -->
    <div class="absolute inset-0 opacity-20">
      <div class="absolute inset-0 bg-contour-lines"></div>
      <div class="absolute inset-0 bg-topo-grid"></div>
    </div>

    <!-- Flow field subtle animation -->
    <div class="absolute inset-0 bg-flow-field opacity-5"></div>

    <div class="container mx-auto px-4 text-center relative z-10">
      <div class="inline-flex items-center gap-2 mb-6 px-4 py-2 bg-signal-blue text-black text-xs font-bold uppercase tracking-widest elevation-1">
        <span class="signal-dot bg-topo-900"></span>
        AI-Powered Motorcycle Database
      </div>

      <h1 class="text-6xl md:text-8xl font-extrabold mb-6 text-topo-900 leading-none tracking-tighter">
        The Motorbike<br class="md:hidden" /> Compendium
      </h1>

      <p class="text-lg md:text-xl mb-10 text-topo-700 max-w-2xl mx-auto font-medium">
        Discover, compare, and explore motorcycles from around the world with intelligent AI-powered insights
      </p>

      <!-- Quick stats - Data-point style -->
      <div class="flex justify-center gap-8 text-sm text-topo-600 mt-8">
        <div class="flex items-center gap-2">
          <span class="data-point bg-signal-red"></span>
          <span class="metric-value text-topo-900">{manufacturerCount}+</span> Brands
        </div>
        <div class="w-px h-4 bg-topo-300"></div>
        <div class="flex items-center gap-2">
          <span class="data-point bg-signal-amber"></span>
          <span class="metric-value text-topo-900">{bikeCount}+</span> Models
        </div>
        <div class="w-px h-4 bg-topo-300"></div>
        <div class="flex items-center gap-2">
          <span class="data-point bg-signal-green"></span>
          <span class="metric-value text-topo-900">AI</span> Insights
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section - Clean data presentation -->
  <section class="py-16 relative">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
        <div class="group relative bg-topo-50 elevation-2 hover:elevation-3 transition-all duration-200 p-10">
          <!-- Corner accent -->
          <div class="absolute top-0 left-0 w-12 h-12 border-t-4 border-l-4 border-signal-blue opacity-40"></div>
          <div class="absolute bottom-0 right-0 w-12 h-12 border-b-4 border-r-4 border-signal-blue opacity-40"></div>

          <div class="relative">
            <div class="text-6xl font-extrabold text-topo-900 mb-3 metric-value">{bikeCount}</div>
            <div class="text-topo-900 font-bold text-sm uppercase tracking-widest">Motorcycle Models</div>
            <div class="text-topo-700 text-xs mt-2 uppercase tracking-wider">And counting...</div>
          </div>
        </div>

        <div class="group relative bg-topo-50 elevation-2 hover:elevation-3 transition-all duration-200 p-10">
          <!-- Corner accent -->
          <div class="absolute top-0 left-0 w-12 h-12 border-t-4 border-l-4 border-signal-amber opacity-40"></div>
          <div class="absolute bottom-0 right-0 w-12 h-12 border-b-4 border-r-4 border-signal-amber opacity-40"></div>

          <div class="relative">
            <div class="text-6xl font-extrabold text-topo-900 mb-3 metric-value">{manufacturerCount}</div>
            <div class="text-topo-900 font-bold text-sm uppercase tracking-widest">Manufacturers</div>
            <div class="text-topo-700 text-xs mt-2 uppercase tracking-wider">Global brands</div>
          </div>
        </div>

        <div class="group relative bg-topo-50 elevation-2 hover:elevation-3 transition-all duration-200 p-10">
          <!-- Corner accent -->
          <div class="absolute top-0 left-0 w-12 h-12 border-t-4 border-l-4 border-signal-green opacity-40"></div>
          <div class="absolute bottom-0 right-0 w-12 h-12 border-b-4 border-r-4 border-signal-green opacity-40"></div>

          <div class="relative">
            <div class="text-6xl font-extrabold text-topo-900 mb-3 metric-value">AI</div>
            <div class="text-topo-900 font-bold text-sm uppercase tracking-widest">Powered Insights</div>
            <div class="text-topo-700 text-xs mt-2 uppercase tracking-wider">Smart recommendations</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 bg-topo-100">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between mb-10">
        <div>
          <h2 class="text-4xl md:text-5xl font-bold text-topo-900 mb-2 tracking-tight">Featured Motorcycles</h2>
          <p class="text-topo-700 text-sm uppercase tracking-wider">Explore our latest additions</p>
        </div>
        <a href="/bikes" class="text-topo-900 hover:text-signal-blue font-bold flex items-center gap-2 group uppercase text-sm tracking-wider">
          View All
          <span class="transform group-hover:translate-x-1 transition-transform">→</span>
        </a>
      </div>

      {motorcycles.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {motorcycles.map(bike => (
            <BikeCard bike={bike} />
          ))}
        </div>
      ) : (
        <div class="text-center py-12 bg-topo-50 elevation-2 rounded">
          <p class="text-topo-900 font-bold">No motorcycles found. Run the seed script to add data!</p>
        </div>
      )}
    </div>
  </section>


  <section class="relative py-20 bg-topo-50 text-topo-900 overflow-hidden">
    <!-- Topographic elements -->
    <div class="absolute inset-0 opacity-15">
      <div class="absolute inset-0 bg-contour-lines"></div>
      <div class="absolute inset-0 bg-topo-grid"></div>
    </div>

    <!-- Signal dots scattered -->
    <div class="absolute inset-0 opacity-40">
      <div class="absolute top-10 left-20 w-3 h-3 bg-signal-red rounded-full"></div>
      <div class="absolute top-32 right-40 w-2 h-2 bg-signal-amber rounded-full"></div>
      <div class="absolute bottom-24 left-1/3 w-3 h-3 bg-signal-green rounded-full"></div>
      <div class="absolute bottom-40 right-20 w-2 h-2 bg-signal-blue rounded-full"></div>
    </div>

    <div class="container mx-auto px-4 text-center relative z-10">
      <h2 class="text-4xl md:text-6xl font-bold mb-4 tracking-tight">Ready to Explore?</h2>
      <p class="text-lg md:text-xl mb-10 text-topo-700 max-w-2xl mx-auto">Discover detailed specs, compare models, and get AI-powered insights to find your perfect ride</p>
      <a href="/bikes" class="inline-block bg-signal-blue text-black px-10 py-4 font-bold hover:bg-topo-900 hover:text-white transition-all duration-200 elevation-2 hover:elevation-3 uppercase tracking-wider text-sm">
        Browse All Motorcycles
        <span class="ml-2">→</span>
      </a>
    </div>
  </section>
</BaseLayout>