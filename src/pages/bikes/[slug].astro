---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { supabase } from '../../lib/supabase';

// This tells Astro which pages to generate
export async function getStaticPaths() {
  const { data: bikes } = await supabase
    .from('motorbike_variants')
    .select(`
      slug,
      *,
      motorbike_models!inner (
        name,
        category,
        description,
        manufacturers!inner (
          name,
          country,
          founded_year
        )
      )
    `);

  return bikes?.map((bike) => ({
    params: { slug: bike.slug },
    props: { bike },
  })) || [];
}

// Get the bike data from props (already fetched in getStaticPaths)
const { bike } = Astro.props;

if (!bike) {
  return Astro.redirect('/404');
}

const manufacturer = bike.motorbike_models.manufacturers;
const model = bike.motorbike_models;
---

<BaseLayout title={`${manufacturer.name} ${model.name} ${bike.variant_name} - The Motorbike Compendium`}>
  <!-- Breadcrumbs -->
  <nav class="bg-topo-100 py-4 elevation-1">
    <div class="container mx-auto px-4">
      <div class="flex items-center gap-2 text-xs text-topo-700 uppercase tracking-wider">
        <a href="/" class="hover:text-signal-blue font-medium">Home</a>
        <span>/</span>
        <a href="/bikes" class="hover:text-signal-blue font-medium">Motorcycles</a>
        <span>/</span>
        <a href={`/manufacturers/${manufacturer.name.toLowerCase().replace(/\s+/g, '-')}`} class="hover:text-signal-blue font-medium">
          {manufacturer.name}
        </a>
        <span>/</span>
        <span class="text-topo-900 font-bold">{model.name}</span>
      </div>
    </div>
  </nav>

  <div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
      <!-- Image Section -->
      <div>
        <div class="bg-gradient-to-br from-topo-700 to-topo-900 h-96 flex items-center justify-center mb-4 relative overflow-hidden elevation-2">
          <!-- Grid overlay -->
          <div class="absolute inset-0 opacity-10">
            <div class="w-full h-full" style="background-image: repeating-linear-gradient(0deg, transparent, transparent 19px, rgba(255,255,255,0.1) 19px, rgba(255,255,255,0.1) 20px), repeating-linear-gradient(90deg, transparent, transparent 19px, rgba(255,255,255,0.1) 19px, rgba(255,255,255,0.1) 20px);"></div>
          </div>
          <span class="text-white text-9xl relative z-10">üèçÔ∏è</span>
        </div>
        <div class="grid grid-cols-4 gap-2">
          <div class="bg-topo-200 h-20 flex items-center justify-center text-2xl elevation-1">üèçÔ∏è</div>
          <div class="bg-topo-200 h-20 flex items-center justify-center text-2xl elevation-1">üèçÔ∏è</div>
          <div class="bg-topo-200 h-20 flex items-center justify-center text-2xl elevation-1">üèçÔ∏è</div>
          <div class="bg-topo-200 h-20 flex items-center justify-center text-2xl elevation-1">üèçÔ∏è</div>
        </div>
      </div>

      <!-- Info Section -->
      <div>
        <!-- Header -->
        <div class="mb-6">
          <div class="flex items-center gap-2 mb-2">
            <span class="signal-dot bg-signal-blue"></span>
            <span class="text-topo-700 font-bold text-xs uppercase tracking-widest">{manufacturer.name}</span>
          </div>
          <h1 class="text-5xl font-bold text-topo-900 mb-2 tracking-tight leading-none">
            {model.name}
          </h1>
          <p class="text-xl text-topo-700 mb-3">{bike.variant_name} ({bike.year})</p>
          {model.category && (
            <span class="inline-block bg-signal-blue text-white px-3 py-1.5 text-xs font-bold uppercase tracking-wider elevation-1">
              {model.category}
            </span>
          )}
        </div>

        <!-- Price & Key Stats - Clean data presentation -->
        <div class="grid grid-cols-3 gap-3 mb-6">
          {bike.price_usd && (
            <div class="bg-topo-100 p-4 relative">
              <div class="absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-signal-red opacity-40"></div>
              <p class="text-xs text-topo-700 uppercase tracking-wide mb-1 font-medium">Price</p>
              <p class="text-2xl font-bold text-topo-900 metric-value">‚Ç¨{bike.price_usd.toLocaleString()}</p>
            </div>
          )}
          {bike.engine_displacement_cc && (
            <div class="bg-topo-100 p-4 relative">
              <div class="absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-signal-amber opacity-40"></div>
              <p class="text-xs text-topo-700 uppercase tracking-wide mb-1 font-medium">Engine</p>
              <p class="text-2xl font-bold text-topo-900 metric-value">{bike.engine_displacement_cc}<span class="text-sm">cc</span></p>
            </div>
          )}
          {bike.horsepower_hp && (
            <div class="bg-topo-100 p-4 relative">
              <div class="absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-signal-green opacity-40"></div>
              <p class="text-xs text-topo-700 uppercase tracking-wide mb-1 font-medium">Power</p>
              <p class="text-2xl font-bold text-topo-900 metric-value">{bike.horsepower_hp}<span class="text-sm">hp</span></p>
            </div>
          )}
        </div>

        <!-- Description -->
        {bike.description && (
          <div class="mb-6 p-4 bg-topo-50 elevation-1">
            <p class="text-topo-900 leading-relaxed">{bike.description}</p>
          </div>
        )}

        <!-- Action Buttons -->
        <div class="flex gap-3">
          <button class="flex-1 bg-topo-900 text-topo-50 px-6 py-3 font-bold hover:bg-signal-blue transition uppercase tracking-wider text-sm elevation-1">
            Add to Comparison
          </button>
          <button class="px-6 py-3 bg-topo-100 text-topo-900 hover:bg-topo-200 transition elevation-1">
            ‚ù§Ô∏è
          </button>
        </div>
      </div>
    </div>

    <!-- Specifications Section -->
    <div class="bg-topo-50 elevation-2 p-8 mb-8 relative">
      <!-- Subtle background pattern -->
      <div class="absolute inset-0 bg-flow-field opacity-10 pointer-events-none"></div>

      <h2 class="text-3xl font-bold text-topo-900 mb-8 tracking-tight relative">Technical Specifications</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative">
        <!-- Engine -->
        <div>
          <h3 class="text-sm font-bold text-topo-900 mb-4 flex items-center uppercase tracking-widest">
            Engine & Performance
          </h3>
          <div class="space-y-2">
            {bike.engine_type && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Engine Type</span>
                <span class="font-bold text-topo-900 metric-value">{bike.engine_type}</span>
              </div>
            )}
            {bike.engine_displacement_cc && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Displacement</span>
                <span class="font-bold text-topo-900 metric-value">{bike.engine_displacement_cc}cc</span>
              </div>
            )}
            {bike.horsepower_hp && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Power</span>
                <span class="font-bold text-topo-900 metric-value">{bike.horsepower_hp} hp</span>
              </div>
            )}
            {bike.torque_nm && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Torque</span>
                <span class="font-bold text-topo-900 metric-value">{bike.torque_nm} Nm</span>
              </div>
            )}
            {bike.top_speed_kmh && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Top Speed</span>
                <span class="font-bold text-topo-900 metric-value">{bike.top_speed_kmh} km/h</span>
              </div>
            )}
            {bike.cooling_system && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Cooling</span>
                <span class="font-bold text-topo-900 metric-value">{bike.cooling_system}</span>
              </div>
            )}
          </div>
        </div>

        <!-- Transmission & Dimensions -->
        <div>
          <h3 class="text-sm font-bold text-topo-900 mb-4 flex items-center uppercase tracking-widest">
            Dimensions & Weight
          </h3>
          <div class="space-y-2">
            {bike.transmission_type && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Transmission</span>
                <span class="font-bold text-topo-900 metric-value">{bike.transmission_type}</span>
              </div>
            )}
            {bike.weight_kg && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Weight</span>
                <span class="font-bold text-topo-900 metric-value">{bike.weight_kg} kg</span>
              </div>
            )}
            {bike.seat_height_mm && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Seat Height</span>
                <span class="font-bold text-topo-900 metric-value">{bike.seat_height_mm} mm</span>
              </div>
            )}
            {bike.fuel_capacity_liters && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Fuel Capacity</span>
                <span class="font-bold text-topo-900 metric-value">{bike.fuel_capacity_liters} L</span>
              </div>
            )}
            {bike.fuel_consumption_l_per_100km && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Fuel Consumption</span>
                <span class="font-bold text-topo-900 metric-value">{bike.fuel_consumption_l_per_100km} L/100km</span>
              </div>
            )}
          </div>
        </div>

        <!-- Brakes & Tires -->
        <div>
          <h3 class="text-sm font-bold text-topo-900 mb-4 flex items-center uppercase tracking-widest">
            Brakes & Tires
          </h3>
          <div class="space-y-2">
            {bike.front_brake_type && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Front Brake</span>
                <span class="font-bold text-topo-900 metric-value">{bike.front_brake_type}</span>
              </div>
            )}
            {bike.rear_brake_type && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Rear Brake</span>
                <span class="font-bold text-topo-900 metric-value">{bike.rear_brake_type}</span>
              </div>
            )}
            {bike.front_tire_size && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Front Tire</span>
                <span class="font-bold text-topo-900 metric-value">{bike.front_tire_size}</span>
              </div>
            )}
            {bike.rear_tire_size && (
              <div class="flex justify-between py-2 isobar">
                <span class="text-topo-700 text-xs uppercase tracking-wider">Rear Tire</span>
                <span class="font-bold text-topo-900 metric-value">{bike.rear_tire_size}</span>
              </div>
            )}
          </div>
        </div>

        <!-- Electronics -->
        <div>
          <h3 class="text-sm font-bold text-topo-900 mb-4 flex items-center uppercase tracking-widest">
            Electronics & Features
          </h3>
          <div class="space-y-2">
            <div class="flex justify-between py-2 isobar">
              <span class="text-topo-700 text-xs uppercase tracking-wider">ABS</span>
              <span class="font-bold text-topo-900 metric-value">{bike.abs ? 'Yes' : 'No'}</span>
            </div>
            <div class="flex justify-between py-2 isobar">
              <span class="text-topo-700 text-xs uppercase tracking-wider">Traction Control</span>
              <span class="font-bold text-topo-900 metric-value">{bike.traction_control ? 'Yes' : 'No'}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Manufacturer Info -->
    <div class="bg-topo-100 elevation-2 p-8">
      <h2 class="text-2xl font-bold text-topo-900 mb-6 tracking-tight">About {manufacturer.name}</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <span class="text-topo-700 text-xs uppercase tracking-wider font-bold">Country</span>
          <p class="font-bold text-lg text-topo-900 mt-1">{manufacturer.country}</p>
        </div>
        <div>
          <span class="text-topo-700 text-xs uppercase tracking-wider font-bold">Founded</span>
          <p class="font-bold text-lg text-topo-900 mt-1 metric-value">{manufacturer.founded_year}</p>
        </div>
        <div class="flex items-end">
          <a href={`/manufacturers/${manufacturer.name.toLowerCase().replace(/\s+/g, '-')}`}
             class="text-topo-900 hover:text-signal-blue font-bold uppercase text-sm tracking-wider inline-flex items-center gap-2">
            View all {manufacturer.name} models ‚Üí
          </a>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>