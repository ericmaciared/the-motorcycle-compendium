---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BikeCard from '../../components/BikeCard.astro';
import { supabase } from '../../lib/supabase';

// Fetch all bikes
const { data: bikes, error } = await supabase
  .from('motorbike_variants')
  .select(`
    *,
    motorbike_models!inner (
      name,
      category,
      manufacturers!inner (
        name
      )
    )
  `)
  .order('created_at', { ascending: false });

if (error) {
  console.error('Error fetching bikes:', error);
}

// Transform data
const motorcycles = bikes?.map(bike => ({
  id: bike.id,
  slug: bike.slug,
  variant_name: bike.variant_name,
  year: bike.year,
  price_usd: bike.price_usd,
  engine_displacement_cc: bike.engine_displacement_cc,
  horsepower_hp: bike.horsepower_hp,
  description: bike.description,
  model_name: bike.motorbike_models.name,
  manufacturer_name: bike.motorbike_models.manufacturers.name,
  category: bike.motorbike_models.category,
})) || [];
---

<BaseLayout title="All Motorcycles - The Motorbike Compendium">
  <div class="container mx-auto px-4 py-12">
    <!-- Header - Large, design studio style -->
    <div class="mb-12">
      <h1 class="text-5xl md:text-6xl font-bold text-topo-900 mb-3 tracking-tight">All Motorcycles</h1>
      <div class="flex items-center gap-3">
        <span class="data-point bg-signal-blue"></span>
        <p class="text-topo-700 uppercase tracking-wider text-sm font-bold">
          {motorcycles.length} motorcycles in database
        </p>
      </div>
    </div>

    <!-- Bikes Grid -->
    {motorcycles.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {motorcycles.map(bike => (
          <BikeCard bike={bike} />
        ))}
      </div>
    ) : (
      <div class="bg-topo-50 elevation-2 p-12 text-center">
        <div class="text-6xl mb-4 text-topo-900">üèçÔ∏è</div>
        <h3 class="text-xl font-bold text-topo-900 mb-2">No motorcycles found</h3>
        <p class="text-topo-800 text-sm uppercase tracking-wider">Check back later for new bikes</p>
      </div>
    )}
  </div>
</BaseLayout>