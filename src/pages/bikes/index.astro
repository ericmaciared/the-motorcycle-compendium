---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BikeCard from '../../components/BikeCard.astro';
import { supabase } from '../../lib/supabase';

// Fetch all bikes
const { data: bikes, error } = await supabase
  .from('motorbike_variants')
  .select(`
    *,
    motorbike_models!inner (
      name,
      category,
      manufacturers!inner (
        name
      )
    )
  `)
  .order('created_at', { ascending: false });

if (error) {
  console.error('Error fetching bikes:', error);
}

// Transform data
const motorcycles = bikes?.map(bike => ({
  id: bike.id,
  slug: bike.slug,
  variant_name: bike.variant_name,
  year: bike.year,
  price_usd: bike.price_usd,
  engine_displacement_cc: bike.engine_displacement_cc,
  horsepower_hp: bike.horsepower_hp,
  description: bike.description,
  model_name: bike.motorbike_models.name,
  manufacturer_name: bike.motorbike_models.manufacturers.name,
  category: bike.motorbike_models.category,
})) || [];
---

<BaseLayout title="All Motorcycles - The Motorbike Compendium">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold mb-2">All Motorcycles</h1>
      <p class="text-slate-600">
        {motorcycles.length} motorcycles
      </p>
    </div>

    <!-- Bikes Grid -->
    {motorcycles.length > 0 ? (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {motorcycles.map(bike => (
          <BikeCard bike={bike} />
        ))}
      </div>
    ) : (
      <div class="bg-white rounded-lg shadow-md p-12 text-center">
        <div class="text-6xl mb-4">üèçÔ∏è</div>
        <h3 class="text-xl font-bold mb-2">No motorcycles found</h3>
        <p class="text-slate-600">Check back later for new bikes</p>
      </div>
    )}
  </div>
</BaseLayout>